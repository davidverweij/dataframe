<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no"
    />
    <title>IoT Canvas</title>

    <!-- update the version number as needed -->
    <script defer src="/__/firebase/7.6.1/firebase-app.js"></script>

    <!-- include only the Firebase features as you need -->
    <script defer src="/__/firebase/7.6.1/firebase-auth.js"></script>
    <script defer src="/__/firebase/7.6.2/firebase-database.js"></script>

    <!-- initialize the SDK after all desired features are loaded -->
    <script defer src="/__/firebase/init.js"></script>

    <!-- Firebase UI setup for authenticating users -->
    <script src="https://www.gstatic.com/firebasejs/ui/4.3.0/firebase-ui-auth.js"></script>
    <link
      type="text/css"
      rel="stylesheet"
      href="https://www.gstatic.com/firebasejs/ui/4.3.0/firebase-ui-auth.css"
    />

    <link rel="stylesheet" type="text/css" href="style.css" />
    <script src="js/p5.js"></script>
  </head>
  <body>
    <div id="firebaseui-auth-container"></div>
    <div class="menu">
      <ul>
        <li>
          <input id="testmode" type="checkbox" checked />
          <label>Testmode</label>
        </li>
        <li>
          <select id="zonesmode">
            <option value="0">no</option>
          </select>
          <label>Zone</label>
        </li>
        <li>
          <div class="switch-toggle">
            <input id="switch-toggle-add" name="state-d" type="radio" checked="checked" />
            <label for="switch-toggle-add" onclick="">ADD</label>

            <input id="switch-toggle-remove" name="state-d" type="radio" checked="" />
            <label for="switch-toggle-remove" class="disabled" onclick="">REMOVE</label>

            <input id="switch-toggle-color" name="state-d" type="radio" />
            <label for="switch-toggle-color" onclick="">COLOR</label>
          </div>
          <label>Zone Editor</label>
        </li>
        <li>
          <input id="drawcolor" type="color" value="#ff0000" />
          <label>Color</label>
        </li>
        <li>
          <input id="updatemode" type="button" value="Update" />
          <label>Database</label>
        </li>
      </ul>
    </div>
    <div id="main"></div>
    <div class="footer"></div>

    <script src="js/LEDS.js"></script>
    <script src="js/PATHS.js"></script>
    <script src="js/sketch_withselect.js"></script>
    <script src="js/iotcanvas.js"></script>

    <script>
      document.addEventListener("DOMContentLoaded", function() {
        // // The Firebase SDK is initialized and available here!

        firebase.auth().onAuthStateChanged(user => {
          if (user) {
            // User is signed in.
            console.log(firebase.auth().currentUser.email + " is logged in!");

            try {
              setTimeout(() => {
                // get p5js running before calling functions
                loadData();
              }, 1000);
            } catch (e) {
              console.error(e);
            }
          } else {
            // Initialize the FirebaseUI Widget using Firebase.
            var ui = new firebaseui.auth.AuthUI(firebase.auth());

            var uiConfig = {
              callbacks: {
                signInSuccessWithAuthResult: function(authResult, redirectUrl) {
                  var user = authResult.user;
                  var credential = authResult.credential;
                  var isNewUser = authResult.additionalUserInfo.isNewUser;
                  var providerId = authResult.additionalUserInfo.providerId;
                  var operationType = authResult.operationType;
                  // Do something with the returned AuthResult.
                  // Return type determines whether we continue the redirect automatically
                  // or whether we leave that to developer to handle.
                  ui.reset();
                  return false;
                }
              },
              //signInSuccessUrl: 'localhost:5000',
              signInOptions: [
                // Leave the lines as is for the providers you want to offer your users.
                firebase.auth.EmailAuthProvider.PROVIDER_ID
              ],
              tosUrl: "<your-tos-url>",
              privacyPolicyUrl: function() {
                window.location.assign("<your-privacy-policy-url>");
              }
            };

            // The start method will wait until the DOM is loaded.
            ui.start("#firebaseui-auth-container", uiConfig);
            // User is signed out.
          }
        });

        // firebase.database().ref('/path/to/ref').on('value', snapshot => { });
        // firebase.messaging().requestPermission().then(() => { });
        // firebase.storage().ref('/path/to/ref').getDownloadURL().then(() => { });
        //
        // // ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥

        try {
          let app = firebase.app();
          let features = ["auth", "database", "messaging", "storage"].filter(
            feature => typeof app[feature] === "function"
          );
          //document.getElementById('load').innerHTML = `Firebase SDK loaded with ${features.join(', ')}`;
        } catch (e) {
          console.error(e);
          //document.getElementById('load').innerHTML = 'Error loading the Firebase SDK, check the console.';
        }
      });
    </script>
  </body>
</html>
